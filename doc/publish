#!/bin/bash

DOC_DIR=doxygen/html
REPO=git@github.com:Microsemi/switchtec-user.git

make

git clone -b gh-pages $REPO gh-pages

if [ ! -d $DOC_DIR ]; then
	echo '' >&2
	echo 'Warning: No documentation (html) files have been found!' >&2
	echo 'Warning: Not going to push the documentation to GitHub!' >&2
	exit 1
fi

cp -r $DOC_DIR/* gh-pages

VN=$(git describe --always --tags --match "v[0-9]*" HEAD 2>/dev/null)

pushd gh-pages
git add --all
git ci -a -m "Autogenerated documentation from $VN"
git push --force origin
popd
